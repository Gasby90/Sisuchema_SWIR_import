%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%% Sisuchema SWIR importer %%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%% Riccardo Gasbarrone 2016 %%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This script allow to import raw and calibration data into MatLab
% calculating the spectra reflectance correction.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%info
h = msgbox('The following is the procedure to follow:  1.	Open .hdr raw data, 2.	Open .hdr dark reference,   3.	Open .hdr white.','INFO','help')
pause (10)
%select first raw data
Raw = opotekenvirdr
%select dark reference (black)
Dark = opotekenvirdr
%select white
White = opotekenvirdr
%select first column of Raw (pixels positions)
%A=Raw(:,1);
%A2=double(A);
%select raw data
%B2=double(Raw);
B3=Raw;
n=size(Raw);
%B3=dataset(B2)
%select dark values
D1=double(Dark);
%Applies bicubic interpolation smoothing & createdataset
D2=imresize(D1, n, 'bicubic' );
D3=dataset(D2)
%select white values
W1=double(White);
%Applies bicubic interpolation smoothing & createdataset
W2=imresize(W1, n, 'bicubic' );
W3=dataset(W2)
%Calculate real reflectance
C=(B3-D3);
F=(W3-D3);
REFL=C./F;
clearvars -except REFL
%create dataset
%REFL=dataset(REFL);
%add wavelenghts
wn=[942.170000000000;948.500000000000;954.820000000000;961.140000000000;967.460000000000;973.790000000000;980.110000000000;986.430000000000;992.750000000000;999.070000000000;1005.39000000000;1011.71000000000;1018.03000000000;1024.34000000000;1030.66000000000;1036.98000000000;1043.30000000000;1049.61000000000;1055.93000000000;1062.25000000000;1068.56000000000;1074.88000000000;1081.19000000000;1087.51000000000;1093.82000000000;1100.14000000000;1106.45000000000;1112.76000000000;1119.08000000000;1125.39000000000;1131.70000000000;1138.01000000000;1144.32000000000;1150.63000000000;1156.94000000000;1163.25000000000;1169.56000000000;1175.87000000000;1182.18000000000;1188.49000000000;1194.80000000000;1201.11000000000;1207.41000000000;1213.72000000000;1220.03000000000;1226.33000000000;1232.64000000000;1238.95000000000;1245.25000000000;1251.55000000000;1257.86000000000;1264.16000000000;1270.47000000000;1276.77000000000;1283.07000000000;1289.37000000000;1295.68000000000;1301.98000000000;1308.28000000000;1314.58000000000;1320.88000000000;1327.18000000000;1333.48000000000;1339.78000000000;1346.08000000000;1352.38000000000;1358.68000000000;1364.97000000000;1371.27000000000;1377.57000000000;1383.86000000000;1390.16000000000;1396.46000000000;1402.75000000000;1409.05000000000;1415.34000000000;1421.64000000000;1427.93000000000;1434.22000000000;1440.52000000000;1446.81000000000;1453.10000000000;1459.39000000000;1465.69000000000;1471.98000000000;1478.27000000000;1484.56000000000;1490.85000000000;1497.14000000000;1503.43000000000;1509.72000000000;1516;1522.29000000000;1528.58000000000;1534.87000000000;1541.16000000000;1547.44000000000;1553.73000000000;1560.01000000000;1566.30000000000;1572.58000000000;1578.87000000000;1585.15000000000;1591.44000000000;1597.72000000000;1604;1610.29000000000;1616.57000000000;1622.85000000000;1629.13000000000;1635.41000000000;1641.70000000000;1647.98000000000;1654.26000000000;1660.54000000000;1666.82000000000;1673.09000000000;1679.37000000000;1685.65000000000;1691.93000000000;1698.21000000000;1704.48000000000;1710.76000000000;1717.04000000000;1723.31000000000;1729.59000000000;1735.86000000000;1742.14000000000;1748.41000000000;1754.69000000000;1760.96000000000;1767.23000000000;1773.51000000000;1779.78000000000;1786.05000000000;1792.32000000000;1798.59000000000;1804.86000000000;1811.13000000000;1817.40000000000;1823.67000000000;1829.94000000000;1836.21000000000;1842.48000000000;1848.75000000000;1855.02000000000;1861.29000000000;1867.55000000000;1873.82000000000;1880.09000000000;1886.35000000000;1892.62000000000;1898.88000000000;1905.15000000000;1911.41000000000;1917.68000000000;1923.94000000000;1930.20000000000;1936.46000000000;1942.73000000000;1948.99000000000;1955.25000000000;1961.51000000000;1967.77000000000;1974.03000000000;1980.29000000000;1986.55000000000;1992.81000000000;1999.07000000000;2005.33000000000;2011.59000000000;2017.85000000000;2024.10000000000;2030.36000000000;2036.62000000000;2042.87000000000;2049.13000000000;2055.39000000000;2061.64000000000;2067.90000000000;2074.15000000000;2080.40000000000;2086.66000000000;2092.91000000000;2099.16000000000;2105.42000000000;2111.67000000000;2117.92000000000;2124.17000000000;2130.42000000000;2136.67000000000;2142.92000000000;2149.17000000000;2155.42000000000;2161.67000000000;2167.92000000000;2174.17000000000;2180.42000000000;2186.66000000000;2192.91000000000;2199.16000000000;2205.40000000000;2211.65000000000;2217.90000000000;2224.14000000000;2230.39000000000;2236.63000000000;2242.87000000000;2249.12000000000;2255.36000000000;2261.60000000000;2267.85000000000;2274.09000000000;2280.33000000000;2286.57000000000;2292.81000000000;2299.05000000000;2305.29000000000;2311.53000000000;2317.77000000000;2324.01000000000;2330.25000000000;2336.49000000000;2342.73000000000;2348.97000000000;2355.20000000000;2361.44000000000;2367.68000000000;2373.91000000000;2380.15000000000;2386.38000000000;2392.62000000000;2398.85000000000;2405.09000000000;2411.32000000000;2417.55000000000;2423.79000000000;2430.02000000000;2436.25000000000;2442.48000000000;2448.71000000000;2454.94000000000;2461.18000000000;2467.41000000000;2473.64000000000;2479.86000000000;2486.09000000000;2492.32000000000;2498.55000000000;2504.78000000000;2511.01000000000;2517.23000000000;2523.46000000000;2529.69000000000;2535.91000000000;2542.14000000000];
REFL.axisscale{2}=wn;
